{"is_source_file": true, "format": "Python", "description": "This file defines a FastAPI router and class for integrating with Confluence through OAuth2, providing endpoints for listing spaces, creating pages, and managing OAuth authentication flow. It includes the ConfluenceConnector class with methods for OAuth login, callback, search, connect, and disconnect, utilizing external classes like ConfluenceClient and various utility functions. The code is part of a larger project implementing a modular connector for Confluence integration.", "external_files": ["src.connectors.base", "src.core.db", "src.core.logging", "src.core.security", "src.core.settings", "src.core.token_store", "src.core.tenants", "src.core.response", "src.core.api_models", ".client", ".mapping"], "external_methods": ["generate_pkce", "verify_csrf_state", "compute_expiry", "get_logger", "ok", "auth_required_error", "config_required_error", "normalize_upstream_error", "validation_error", "get_tenant_id", "TokenStore.ensure_valid_token_atlassian", "ConfluenceClient.search_pages", "ConfluenceClient.list_spaces", "ConfluenceClient.create_page", "normalize_create_page", "normalize_search_pages"], "published": ["factory", "get_router"], "classes": [{"name": "ConfluenceConnector", "description": "A connector class for integrating with Confluence, handling OAuth authentication, page searching, and page creation, tailored for tenant-specific operation within the application."}], "methods": [{"name": "OAuthLoginResponse oauth_login(self, redirect_to: Optional[str] = None)", "description": "Builds the OAuth2 authorization URL with PKCE and CSRF protection, and initiates OAuth login process.", "scope": "ConfluenceConnector", "scopeKind": "class"}, {"name": "oauth_callback(self, code: str, state: Optional[str])", "description": "Handles OAuth callback, exchanges code for tokens, and retrieves Confluence cloud ID.", "scope": "ConfluenceConnector", "scopeKind": "class"}, {"name": "Dict[str,Any] search(self, params: SearchParams)", "description": "Performs a search for Confluence pages based on query params, supporting cursor-based pagination.", "scope": "ConfluenceConnector", "scopeKind": "class"}, {"name": "connect(self)", "description": "Checks if the tenant is connected to Confluence via valid OAuth tokens.", "scope": "ConfluenceConnector", "scopeKind": "class"}, {"name": "disconnect(self)", "description": "Removes stored OAuth tokens and disconnects the tenant from Confluence.", "scope": "ConfluenceConnector", "scopeKind": "class"}, {"name": "__init__(self, tenant_id: str)", "scope": "ConfluenceConnector", "scopeKind": "class", "description": "unavailable"}, {"name": "Optional[str] _get_cloud_id(connector: \"ConfluenceConnector\")", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "create_page(payload: ConfluenceCreatePageModel, tenant_id: str = Depends(get_tenant_id))", "scope": "get_router", "scopeKind": "function", "description": "unavailable"}, {"name": "ConfluenceConnector factory(tenant_id: str)", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "Dict[str,Any] get_public_info(self)", "scope": "ConfluenceConnector", "scopeKind": "class", "description": "unavailable"}, {"name": "APIRouter get_router()", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "list_spaces(tenant_id: str = Depends(get_tenant_id))", "scope": "get_router", "scopeKind": "function", "description": "unavailable"}], "calls": ["generate_pkce()", "verify_csrf_state()", "compute_expiry()", "get_logger()", "ok()", "auth_required_error()", "config_required_error()", "normalize_upstream_error()", "validation_error()", "get_tenant_id()", "TokenStore.ensure_valid_token_atlassian()", "ConfluenceClient.search_pages()", "ConfluenceClient.list_spaces()", "ConfluenceClient.create_page()"], "search-terms": ["Confluence OAuth", "Confluence search pages", "Confluence create page", "Confluence cloud ID", "OAuth PKCE", "Confluence spaces API", "Confluence page creation endpoint", "tenant-specific Confluence connector"], "state": 2, "file_id": 18, "knowledge_revision": 106, "git_revision": "0c75f47244f4f432c9b0e4fad82f1ce106846f59", "revision_history": [{"37": ""}, {"49": "d003e778e8476d42a3bfd185a6f01fbb63bf40e2"}, {"56": "379774def9059dafe18d2301fc45048fa432be1e"}, {"67": "379774def9059dafe18d2301fc45048fa432be1e"}, {"71": "35f8cee06127abfa45ba15d76ea15219c4e0d3bf"}, {"96": "35f8cee06127abfa45ba15d76ea15219c4e0d3bf"}, {"97": "35f8cee06127abfa45ba15d76ea15219c4e0d3bf"}, {"98": "35f8cee06127abfa45ba15d76ea15219c4e0d3bf"}, {"101": "7d15ced419e8f88a8eb26d6e8f636ff1ac2ce571"}, {"104": "7d15ced419e8f88a8eb26d6e8f636ff1ac2ce571"}, {"105": "7d15ced419e8f88a8eb26d6e8f636ff1ac2ce571"}, {"106": "0c75f47244f4f432c9b0e4fad82f1ce106846f59"}], "ctags": [{"_type": "tag", "name": "ConfluenceConnector", "path": "/home/kavia/workspace/code-generation/unified-integration-hub-144005-144014/unified_connector_backend/src/connectors/confluence/router.py", "pattern": "/^class ConfluenceConnector(BaseConnector):$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "__init__", "path": "/home/kavia/workspace/code-generation/unified-integration-hub-144005-144014/unified_connector_backend/src/connectors/confluence/router.py", "pattern": "/^    def __init__(self, tenant_id: str):$/", "language": "Python", "kind": "member", "signature": "(self, tenant_id: str)", "scope": "ConfluenceConnector", "scopeKind": "class"}, {"_type": "tag", "name": "_get_cloud_id", "path": "/home/kavia/workspace/code-generation/unified-integration-hub-144005-144014/unified_connector_backend/src/connectors/confluence/router.py", "pattern": "/^def _get_cloud_id(connector: \"ConfluenceConnector\") -> Optional[str]:$/", "language": "Python", "typeref": "typename:Optional[str]", "kind": "function", "signature": "(connector: \"ConfluenceConnector\")"}, {"_type": "tag", "name": "connect", "path": "/home/kavia/workspace/code-generation/unified-integration-hub-144005-144014/unified_connector_backend/src/connectors/confluence/router.py", "pattern": "/^    async def connect(self):$/", "language": "Python", "kind": "member", "signature": "(self)", "scope": "ConfluenceConnector", "scopeKind": "class"}, {"_type": "tag", "name": "create_page", "path": "/home/kavia/workspace/code-generation/unified-integration-hub-144005-144014/unified_connector_backend/src/connectors/confluence/router.py", "pattern": "/^    async def create_page(payload: ConfluenceCreatePageModel, tenant_id: str = Depends(get_tenan/", "file": true, "language": "Python", "kind": "function", "signature": "(payload: ConfluenceCreatePageModel, tenant_id: str = Depends(get_tenant_id))", "scope": "get_router", "scopeKind": "function"}, {"_type": "tag", "name": "disconnect", "path": "/home/kavia/workspace/code-generation/unified-integration-hub-144005-144014/unified_connector_backend/src/connectors/confluence/router.py", "pattern": "/^    async def disconnect(self):$/", "language": "Python", "kind": "member", "signature": "(self)", "scope": "ConfluenceConnector", "scopeKind": "class"}, {"_type": "tag", "name": "factory", "path": "/home/kavia/workspace/code-generation/unified-integration-hub-144005-144014/unified_connector_backend/src/connectors/confluence/router.py", "pattern": "/^def factory(tenant_id: str) -> ConfluenceConnector:$/", "language": "Python", "typeref": "typename:ConfluenceConnector", "kind": "function", "signature": "(tenant_id: str)"}, {"_type": "tag", "name": "get_public_info", "path": "/home/kavia/workspace/code-generation/unified-integration-hub-144005-144014/unified_connector_backend/src/connectors/confluence/router.py", "pattern": "/^    def get_public_info(self) -> Dict[str, Any]:$/", "language": "Python", "typeref": "typename:Dict[str,Any]", "kind": "member", "signature": "(self)", "scope": "ConfluenceConnector", "scopeKind": "class"}, {"_type": "tag", "name": "get_router", "path": "/home/kavia/workspace/code-generation/unified-integration-hub-144005-144014/unified_connector_backend/src/connectors/confluence/router.py", "pattern": "/^def get_router() -> APIRouter:$/", "language": "Python", "typeref": "typename:APIRouter", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "id", "path": "/home/kavia/workspace/code-generation/unified-integration-hub-144005-144014/unified_connector_backend/src/connectors/confluence/router.py", "pattern": "/^    id = \"confluence\"$/", "language": "Python", "kind": "variable", "scope": "ConfluenceConnector", "scopeKind": "class"}, {"_type": "tag", "name": "list_spaces", "path": "/home/kavia/workspace/code-generation/unified-integration-hub-144005-144014/unified_connector_backend/src/connectors/confluence/router.py", "pattern": "/^    async def list_spaces(tenant_id: str = Depends(get_tenant_id)):$/", "file": true, "language": "Python", "kind": "function", "signature": "(tenant_id: str = Depends(get_tenant_id))", "scope": "get_router", "scopeKind": "function"}, {"_type": "tag", "name": "logger", "path": "/home/kavia/workspace/code-generation/unified-integration-hub-144005-144014/unified_connector_backend/src/connectors/confluence/router.py", "pattern": "/^logger = get_logger(__name__)$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "name", "path": "/home/kavia/workspace/code-generation/unified-integration-hub-144005-144014/unified_connector_backend/src/connectors/confluence/router.py", "pattern": "/^    name = \"Confluence\"$/", "language": "Python", "kind": "variable", "scope": "ConfluenceConnector", "scopeKind": "class"}, {"_type": "tag", "name": "oauth_callback", "path": "/home/kavia/workspace/code-generation/unified-integration-hub-144005-144014/unified_connector_backend/src/connectors/confluence/router.py", "pattern": "/^    async def oauth_callback(self, code: str, state: Optional[str]):$/", "language": "Python", "kind": "member", "signature": "(self, code: str, state: Optional[str])", "scope": "ConfluenceConnector", "scopeKind": "class"}, {"_type": "tag", "name": "oauth_login", "path": "/home/kavia/workspace/code-generation/unified-integration-hub-144005-144014/unified_connector_backend/src/connectors/confluence/router.py", "pattern": "/^    async def oauth_login(self, redirect_to: Optional[str] = None) -> OAuthLoginResponse:$/", "language": "Python", "typeref": "typename:OAuthLoginResponse", "kind": "member", "signature": "(self, redirect_to: Optional[str] = None)", "scope": "ConfluenceConnector", "scopeKind": "class"}, {"_type": "tag", "name": "router", "path": "/home/kavia/workspace/code-generation/unified-integration-hub-144005-144014/unified_connector_backend/src/connectors/confluence/router.py", "pattern": "/^router = APIRouter()$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "search", "path": "/home/kavia/workspace/code-generation/unified-integration-hub-144005-144014/unified_connector_backend/src/connectors/confluence/router.py", "pattern": "/^    async def search(self, params: SearchParams) -> Dict[str, Any]:$/", "language": "Python", "typeref": "typename:Dict[str,Any]", "kind": "member", "signature": "(self, params: SearchParams)", "scope": "ConfluenceConnector", "scopeKind": "class"}], "hash": "bd447a98e384cdca1ae5e710e4a48338", "format-version": 4, "code-base-name": "unified_connector_backend", "filename": "unified_connector_backend/src/connectors/confluence/router.py", "fields": [{"name": "id = \"confluence\"", "scope": "ConfluenceConnector", "scopeKind": "class", "description": "unavailable"}, {"name": "logger = get_logger(__name__)", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "name = \"Confluence\"", "scope": "ConfluenceConnector", "scopeKind": "class", "description": "unavailable"}, {"name": "router = APIRouter()", "scope": "", "scopeKind": "", "description": "unavailable"}]}